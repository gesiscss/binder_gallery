<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="GESIS Notebooks ({{version}})">
  {#<meta name="author" content="">#}
  <title>{% block title %}GESIS Notebooks ({{version}}){% endblock %}</title>
  {% block head %}
  <script src="/static/vendor/jquery-3.2.1.min.js"></script>
  <script src="/static/vendor/bootstrap/js/bootstrap.min.js"></script>
  <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
{#  <link href="/static/vendor/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" />#}
  <link href="/static/notebooks.css" rel="stylesheet" />
  <link id="favicon" rel="shortcut icon" type="image/png" href="/static/images/logo/logo.png" />
  {% endblock head %}

  {% block extra_css %}
  {% endblock extra_css %}

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/static/vendor/html5shiv.min.js"></script>
      <script src="/static/vendor/respond.min.js"></script>
    <![endif]-->

  {% block etracker %}
  {% if production %}
  {% set etracker_prefix = "NOTEBOOKS" %}
  <!-- Copyright (c) 2000-2016 etracker GmbH. All rights reserved. -->
  <!-- This material may not be reproduced, displayed, modified or distributed -->
  <!-- without the express prior written permission of the copyright holder. -->
  <!-- etracker tracklet 4.0 -->
  <script type="text/javascript">
      var et_pagename = "{{ etracker_prefix }}{% block etracker_et_pagename %}{% endblock etracker_et_pagename %}";
      var et_areas = "{{ etracker_prefix }}{% block etracker_et_areas %}{% endblock etracker_et_areas %}";
  </script>
  <script id="_etLoader" type="text/javascript" charset="UTF-8" data-secure-code="qPKGYV"
          src="//static.etracker.com/code/e.js"></script>
  <noscript>
      <link rel="stylesheet" media="all"
            href="//www.etracker.de/cnt_css.php?et=qPKGYV&amp;v=4.0&amp;java=n&amp;et_easy=0&amp;
                  et_pagename={{ etracker_prefix }}{% block etracker_et_pagename_nojs %}{% endblock etracker_et_pagename_nojs %}&amp;
                  et_areas={{ etracker_prefix }}{% block etracker_et_areas_nojs %}{% endblock etracker_et_areas_nojs %}&amp;
                  et_ilevel=0&amp;et_target=,0,0,0&amp;et_lpage=0&amp;et_trig=0&amp;et_se=0&amp;et_cust=0&amp;
                  et_basket=&amp;et_url=&amp;et_tag=&amp;et_sub=&amp;et_organisation=&amp;et_demographic="/>
  </noscript>
  <!-- etracker tracklet 4.0 end -->
  {% endif %}
  {% endblock etracker %}
</head>

<body>
    {% block body %}

    {% block gesis_header %}
    {% include "gesis/header.html" %}
    {% endblock gesis_header %}

    {% block nav_bar %}
    {% endblock nav_bar %}

    <div id="main-container" class="container">
        {% block headline %}
        {% endblock headline %}

        {% block binder_select %}
        {%  with binders = binders  %}
        {% include "select_binder.html" %}
        {% endwith %}
        {% endblock binder_select %}

        {% block main %}
        {% endblock main %}
    </div>

    {% block extra_container %}
    {% endblock extra_container %}

    {% block footer %}
    {% include "gesis/footer.html" %}
    {% endblock footer %}

    {% endblock body %}

    <script src="/static/scripts/gesis_nav.js"></script>
    <script src="/static/scripts/description_row.js"></script>

    {% block binder_select_js %}
    <script>

    function update_launch_urls() {
        var binder_select = $('#binder-select');
        var prev_binder_url = binder_select.attr('data-binder');
        var new_binder_url = binder_select.prop('value');

        $('.launch-badge-link').each(function () {
            var href = $(this).attr('href');
            $(this).attr('href', href.replace(prev_binder_url, new_binder_url));
        });

        // save latest binder url in select element
        binder_select.attr('data-binder', new_binder_url);
    }

    function update_binder_data() {
        // update content of popover with versions info of each selected binder
        $("#binder-versions-info").data('bs.popover').options.content = $('#binder-select').find('option:selected').data('versions');

        // update launch badge urls for selected binder
        update_launch_urls();
    }

    $( document ).ready(function() {
        // https://getbootstrap.com/docs/3.3/javascript/#popovers-options
        // initialize popover without content
        $("#binder-versions-info").popover({'trigger': 'hover'});

        // update data with last saved selection
        update_binder_data();

        // add event to update binder launch urls and version info when selection changes
        $('#binder-select').change(function() {
            $.ajax({
              method: "POST",
              url: "/select_binder",
              contentType: 'application/json;charset=UTF-8',
              data: JSON.stringify({ name: $('#binder-select').find('option:selected').data('name') })
            })
              .done(function(msg) {
                console.log(msg);
                update_binder_data();
              }
              );
        });
    });

    </script>
    {% endblock binder_select_js %}

    {% block extra_js %}
    {% endblock extra_js %}
</body>
</html>
